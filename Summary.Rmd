---
title: "summary"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set( echo=FALSE, message=FALSE, warning=FALSE)
library(printr)
library(knitr)
library(dplyr)
load("SpawnClust.RData")
```

## Cluster Parameters

```{r cluster_params}

kable(cluster[,c(1,2,4,8,12)])
```

## Cluster Frequency over time


```{r spawn_time, fig.height=11, fig.width= 8.5}



spawn.num.12<-spawn.num[spawn.num$YEAR==2012,]
spawn.num.13<-spawn.num[spawn.num$YEAR==2013,]
spawn.num.14<-spawn.num[spawn.num$YEAR==2014,]


peakdates<-function(date,freq){
  data<-data.frame(DATE=date,
                    FREQ=freq)
  peak<-data.frame(START=min(data$DATE[data$FREQ>=(max(data$FREQ)/2)]),
                   END=max(data$DATE[data$FREQ>=(max(data$FREQ)/2)]))
  
}

peakdates.12<-peakdates(date=spawn.num.12$DATE,freq=spawn.num.12$FREQ)
peakdates.13<-peakdates(date=spawn.num.13$DATE,freq=spawn.num.13$FREQ)
peakdates.g13<-peakdates(date=spawn.num.13$DATE,freq=spawn.num.13$FREQ13)
peakdates.14<-peakdates(date=spawn.num.14$DATE,freq=spawn.num.14$FREQ)
peakdates.g14<-peakdates(date=spawn.num.14$DATE,freq=spawn.num.14$FREQ14)

par(mfrow=c(3,1))

#2012
plot(FREQ/24~DATE,data=spawn.num.12,ylim=c(0,3),
     xlim=as.POSIXct(c("2012-08-15","2012-10-15"),format="%Y-%m-%d", tz="MST"),type="h",col="grey",
     lwd=6,lend=2)
lines(c(peakdates.12$START-12*60*60,peakdates.12$START-12*60*60),c(-1,3.5))
lines(c(peakdates.12$END+12*60*60,peakdates.12$END+12*60*60),c(-1,3.5))

#2013 group 2013
plot(FREQ13/9~DATE,data=spawn.num.13,ylim=c(0,3),
     xlim=as.POSIXct(c("2013-08-15","2013-10-15"),format="%Y-%m-%d", tz="MST"), type="h",col="grey",
     lwd=6,lend=2)
lines(c(peakdates.g13$START-12*60*60,peakdates.g13$START-12*60*60),c(-1,3.5))
lines(c(peakdates.g13$END+12*60*60,peakdates.g13$END+12*60*60),c(-1,3.5))

#2014 group 2014
plot(FREQ14/3~DATE,data=spawn.num.14,ylim=c(0,3),
     xlim=as.POSIXct(c("2014-08-15","2014-10-15"),format="%Y-%m-%d", tz="MST"),type="h",col="grey",
     lwd=6,lend=2)
lines(c(peakdates.g14$START-12*60*60,peakdates.g14$START-12*60*60),c(-1,3))
lines(c(peakdates.g14$END+12*60*60,peakdates.g14$END+12*60*60),c(-1,3))



par(mfrow=c(1,1))


```

##Spawning Shoal Use

```{r }


library(mapplots)
library(maptools)
library(scales)


data<-first.clust
xyz<-make.xyz(x=data$CLUST.X,y=data$CLUST.Y,z=data$FREQ,group=data$YEAR)

plot(shore_outline)
  
draw.pie(z=xyz$z, x=xyz$x, y=xyz$y, 
        radius=100, col=c(alpha("#AEC6CF", 0.7), alpha("#FF6961", 0.7), alpha("#FDFD96", 0.7)),
        border=c(alpha("#AEC6CF", 1), alpha("#FF6961", 1), alpha("#FDFD96", 1))) 

text(650800,6954500, "Year",font=2) 
legend.pie(650800,6954300, labels=c("2012","2013","2014"), radius = 100,
           bty="n", col=c(alpha("#AEC6CF", 0.7), alpha("#FF6961", 0.7), alpha("#FDFD96", 0.7)),
           border=c(alpha("#AEC6CF", 1), alpha("#FF6961", 1), alpha("#FDFD96", 1)),
           label.dist=1.7)

text(650800,6954000, "Frequency",font=2) 
legend.bubble(650800,6953800, z=92, round=1, n=1, maxradius=100, bty="n",txt.col="transparent")
text(650950,6953800, "92", cex=0.8) 
legend.bubble(650800,6953625, z=46, round=1, n=1, maxradius=50, bty="n",txt.col="transparent")
text(650900,6953625, "46", cex=0.7) 
legend.bubble(650800,6953525, z=23, round=1, n=1, maxradius=25, bty="n",txt.col="transparent")
text(650875,6953525,"23", cex=0.6) 
legend.bubble(650800,6953462, z=12, round=1, n=1, maxradius=13, bty="n",txt.col="transparent")
text(650862,6953462, "12", cex=0.5)               



#determine max frequency
max.all<-max(first.clust$FREQ)

#2012
data<-filter(first.clust,YEAR==2012)
#determine scaling factor
s=max(data$FREQ)/max.all

plot(shore_outline, main=data$YEAR[1], col="grey90",border="grey70")

draw.bubble(z=data$FREQ, x=data$CLUST.X, y=data$CLUST.Y, 
         maxradius=200*s, col=alpha("lightblue", 0.3),pch=19)
draw.bubble(z=data$FREQ, x=data$CLUST.X, y=data$CLUST.Y, 
            maxradius=200*s, col=alpha("blue",0.3))


legend.bubble(650800,6954000, z=max.all, round=1, n=3, maxradius=200, bty="n",pch=19,
              col=alpha("lightblue",0.3), txt.cex = 0.7, txt.col="transparent")
legend.bubble(650800,6954000, z=max.all, round=0, n=3, maxradius=200, bty="n",
              col=alpha("blue",0.3),txt.cex = 0.7, txt.col = alpha("blue",0.3))


#2013
data<-filter(first.clust,YEAR==2013)
#determine scaling factor
s=max(data$FREQ)/max.all
plot(shore_outline, main=data$YEAR[1], col="grey90",border="grey70")

draw.bubble(z=data$FREQ, x=data$CLUST.X, y=data$CLUST.Y, 
            maxradius=200*s, col=alpha("lightblue", 0.3),pch=19)
draw.bubble(z=data$FREQ, x=data$CLUST.X, y=data$CLUST.Y, 
            maxradius=200*s, col=alpha("blue",0.3))


legend.bubble(650800,6954000, z=max.all, round=1, n=3, maxradius=200, bty="n",pch=19,
              col=alpha("lightblue",0.3), txt.cex = 0.7, txt.col="transparent")
legend.bubble(650800,6954000, z=max.all, round=0, n=3, maxradius=200, bty="n",
              col=alpha("blue",0.3),txt.cex = 0.7, txt.col = alpha("blue",0.3))


#2014
data<-filter(first.clust,YEAR==2014)
#determine scaling factor
s=max(data$FREQ)/max.all

plot(shore_outline, main=data$YEAR[1], col="grey90",border="grey70")

draw.bubble(z=data$FREQ, x=data$CLUST.X, y=data$CLUST.Y, 
            maxradius=200*s, col=alpha("lightblue", 0.3),pch=19)
draw.bubble(z=data$FREQ, x=data$CLUST.X, y=data$CLUST.Y, 
            maxradius=200*s, col=alpha("blue",0.3))


legend.bubble(650800,6954000, z=max.all, round=1, n=3, maxradius=200, bty="n",pch=19,
              col=alpha("lightblue",0.3), txt.cex = 0.7, txt.col="transparent")
legend.bubble(650800,6954000, z=max.all, round=0, n=3, maxradius=200, bty="n",
              col=alpha("blue",0.3),txt.cex = 0.7, txt.col = alpha("blue",0.3))


```

```{r}
data<-spawntable[spawntable$MONTH==9,]
data$ACCEL.SD[is.nan(data$ACCEL.SD)]<-"-"
data$ACCEL.MEAN[is.nan(data$ACCEL.MEAN)]<-"-"
kable(data)
```
```{r}

#select only males or females
data<-daily[daily$MONTH==9 & (daily$SEX=="M" | daily$SEX=="F"),]


```




